define("app/tokens",[],function(){function n(t,n,r){if(t in e)return{type:"token",tokentype:t,value:n,meta:r};throw{type:"ValueError",expected:"valid token type",actual:t}}var e={whitespace:/^(\s+)/,"open-paren":/^(\()/,"close-paren":/^(\))/,"open-square":/^(\[)/,"close-square":/^(\])/,"open-curly":/^(\{)/,"close-curly":/^(\})/,comment:/^;(.*)/,"float":/^(\d*\.\d+|\d+\.\d*)/,integer:/^(\d+)/,symbol:/^([a-zA-Z\!\@\#\$\%\^\&\*\-\_\=\+\?\/\<\>][a-zA-Z0-9\!\@\#\$\%\^\&\*\-\_\=\+\?\/\<\>]*)/,string:/^"([^"]*)"/},t=["whitespace","open-paren","open-square","close-paren","close-square","open-curly","close-curly","comment","string","float","integer","symbol"];return{Token:n,REGEXES:e,PRIORITIES:t}}),define("libs/maybeerror",[],function(){function t(t,n){if(!(t in e))throw new Error("invalid MaybeError constructor name: "+t);this.status=t,this.value=n}var e={success:1,failure:1,error:1};return t.prototype.fmap=function(e){return this.status==="success"?new t("success",e(this.value)):this},t.pure=function(e){return new t("success",e)},t.prototype.ap=function(e){return this.status==="success"?e.fmap(this.value):this},t.prototype.bind=function(e){return this.status==="success"?e(this.value):this},t.error=function(e){return new t("error",e)},t.prototype.mapError=function(e){return this.status==="error"?t.error(e(this.value)):this},t.prototype.plus=function(e){return this.status==="failure"?e:this},t.zero=new t("failure",undefined),t}),define("app/tokenizer",["app/tokens","libs/maybeerror"],function(e,t){function n(e,n,r,i){return t.error({message:e,line:n,column:r,rest:i})}function r(e){var t=0,n=0,r;for(r=0;r<e.length;r++)e[r]==="\n"?(t++,n=0):n++;return[t,n]}function i(i,s,o){var u,a,f,l,c,h,p;if(i==="")return t.zero;for(a=0;a<e.PRIORITIES.length;a++){f=e.PRIORITIES[a];if(u=i.match(e.REGEXES[f]))return c=r(u[0]),h=s+c[0],p=(c[0]>0?1:o)+c[1],t.pure({token:e.Token(f,u[1],{line:s,column:o}),rest:i.substring(u[0].length),line:h,column:p})}return i[0]==='"'?n("end-of-string not found",s,o,i):n("no tokens matched",s,o,i)}function s(e){var n=[],r,s=1,o=1;for(;;){r=i(e,s,o);if(r.status==="error")return r;if(r.status==="failure")break;n.push(r.value.token),e=r.value.rest,s=r.value.line,o=r.value.column}return t.pure(n)}return{tokenize:s}}),define("app/ast",[],function(){function e(e,t,n,r){return{type:e,"function":t,expected:n,actual:r,module:"ast"}}function t(t,n){if(typeof t!="number")throw e("TypeError","number","number",typeof t);return{type:"astnode",asttype:"number",value:t,meta:n}}function n(t,n){if(typeof t!="string")throw e("TypeError","symbol","string",typeof t);return{type:"astnode",asttype:"symbol",value:t,meta:n}}function r(t){if(typeof t!="string")throw e("TypeError","char","string",typeof t);if(t.length!==1)throw e("ValueError","char","length of 1",t.length);return{type:"astnode",asttype:"char",value:t}}function i(t,n){if(t.length===undefined||typeof t=="string")throw e("TypeError","list","array",typeof t);return{type:"astnode",asttype:"list",elements:t,meta:n}}function s(t,n,r){if(t.type!=="astnode")throw e("TypeError","application","astnode",t.type);if(n.length===undefined||typeof n=="string")throw e("TypeError","application","array",typeof n);return{type:"astnode",asttype:"application",operator:t,arguments:n,meta:r}}function o(t,n,r){if(typeof t!="string")throw e("TypeError","define","string",typeof t);return{type:"astnode",asttype:"define",symbol:t,value:n,meta:r}}function u(t,n,r){if(typeof t!="string")throw e("TypeError","set","string",typeof t);return{type:"astnode",asttype:"set",symbol:t,value:n,meta:r}}function a(t,n,r){var i,s;if(t.length===undefined||typeof t=="string")throw e("TypeError","cond","array",typeof t);for(i=0;i<t.length;i++){s=t[i];if(s.length===undefined||typeof s=="string")throw e("TypeError","cond","array",typeof s);if(s.length!==2)throw e("ValueError","cond","length of 2",s.length)}return{type:"astnode",asttype:"cond",branches:t,elseValue:n,meta:r}}function f(t,n,r,i){var s={},o,u;if(t.length===undefined||typeof t=="string")throw e("TypeError","lambda","array",typeof t);for(u=0;u<t.length;u++){o=t[u];if(typeof o!="string")throw e("TypeError","lambda","string",typeof o);if(o in s)throw e("ValueError","lambda","unique parameter names",o);s[o]=1}if(n.length===undefined||typeof n=="string")throw e("TypeError","lambda","array",typeof n);if(r.type!=="astnode")throw e("ValueError","lambda","astnode",r.type);return{type:"astnode",asttype:"lambda",parameters:t,bodies:n,returnValue:r,meta:i}}return{number:t,"char":r,symbol:n,list:i,application:s,define:o,set:u,cond:a,lambda:f}}),define("libs/parsercombinators",[],function(){function e(e){function t(e){this.parse=e}function n(e,t,n,r){throw new Error(JSON.stringify({type:t,"function":e,expected:n,actual:r}))}function r(e,t,n){return{state:n,rest:t,result:e}}function i(t,n,i){return e.pure(r(t,n,i))}function s(e,t){return e===t}return t.item=new t(function(t,n){if(t.length===0)return e.zero;var r=t[0];return i(r,t.slice(1),n)}),t.prototype.fmap=function(e){typeof e!="function"&&n("fmap","TypeError","function",e);var i=this;return new t(function(t,n){return i.parse(t,n).fmap(function(t){return r(e(t.result),t.rest,t.state)})})},t.pure=function(e){return new t(function(t,n){return i(e,t,n)})},t.prototype.bind=function(e){typeof e!="function"&&n("bind","TypeError","function",e);var r=this;return new t(function(t,n){var i=r.parse(t,n),s=i.value;return i.status==="success"?e(s.result).parse(s.rest,s.state):i})},t.prototype.plus=function(e){e instanceof t||n("plus","TypeError","Parser",e);var r=this;return new t(function(t,n){return r.parse(t,n).plus(e.parse(t,n))})},t.zero=new t(function(t,n){return e.zero}),t.error=function(n){return new t(function(t,r){return e.error(n)})},t.prototype.mapError=function(e){typeof e!="function"&&n("mapError","TypeError","function",e);var r=this;return new t(function(t,n){return r.parse(t,n).mapError(e)})},t.get=new t(function(e,t){return i(e,e,t)}),t.put=function(e){return new t(function(t,n){return i(null,e,n)})},t.getState=new t(function(e,t){return i(t,e,t)}),t.putState=function(e){return new t(function(t,n){return i(null,t,e)})},t.updateState=function(e){return new t(function(t,n){return i(null,t,e(n))})},t.prototype.check=function(r){typeof r!="function"&&n("check","TypeError","function",r);var i=this;return new t(function(t,n){var s=i.parse(t,n);return s.status!=="success"?s:r(s.value.result)?s:e.zero})},t.literal=function(e,r){var i=r?r:s;return typeof i!="function"&&n("literal","TypeError","function",i),t.item.check(i.bind(null,e))},t.satisfy=function(e){return typeof e!="function"&&n("satisfy","TypeError","function",e),t.item.check(e)},t.prototype.many0=function(){var e=this;return new t(function(t,n){var r=[],s=t,o=n,u;for(;;){u=e.parse(s,o);if(u.status!=="success")return u.status==="failure"?i(r,s,o):u;r.push(u.value.result),o=u.value.state,s=u.value.rest}})},t.prototype.many1=function(){return this.many0().check(function(e){return e.length>0})},t.all=function(r){return r.map(function(e){e instanceof t||n("all","TypeError","Parser",e)}),new t(function(t,n){var i=[],s,o,u=n,a=t;for(s=0;s<r.length;s++){o=r[s].parse(a,u);if(o.status==="error")return o;if(o.status!=="success")return e.zero;i.push(o.value.result),u=o.value.state,a=o.value.rest}return e.pure({state:u,rest:a,result:i})})},t.app=function(e,n){var r=t.all(Array.prototype.slice.call(arguments,1));return r.fmap(function(t){return e.apply(undefined,t)})},t.prototype.optional=function(e){return this.plus(t.pure(e))},t.prototype.not0=function(){var n=this;return new t(function(t,r){var s=n.parse(t,r);return s.status==="error"?s:s.status==="success"?e.zero:i(null,t,r)})},t.prototype.not1=function(){return this.not0().seq2R(t.item)},t.prototype.commit=function(e){return this.plus(t.error(e))},t.prototype.seq2L=function(e){return e instanceof t||n("seq2L","TypeError","Parser",e),t.all([this,e]).fmap(function(e){return e[0]})},t.prototype.seq2R=function(e){return e instanceof t||n("seq2R","TypeError","Parser",e),t.all([this,e]).fmap(function(e){return e[1]})},t.string=function(e,n){var r=[];for(var i=0;i<e.length;i++)r.push(t.literal(e[i],n));return t.all(r).seq2R(t.pure(e))},t.any=function(r){return r.map(function(e){e instanceof t||n("any","TypeError","Parser",e)}),new t(function(t,n){var i=e.zero,s;for(s=0;s<r.length;s++){i=r[s].parse(t,n);if(i.status==="success"||i.status==="error")return i}return i})},t}return e}),define("libs/parser",["libs/maybeerror","libs/parsercombinators"],function(e,t){var n=t(e);return n}),define("app/parser",["app/ast","libs/parser","libs/maybeerror"],function(e,t,n){function r(e){return t.satisfy(function(t){return t.tokentype===e})}function s(t){var n=t.value.split("").map(e.char);return e.list(n,t.meta)}function h(e){return u.check(function(t){return t.value===e})}function p(e,t,n){return{rule:e,message:"expected "+t,open:n}}function d(n){return h("define").seq2R(t.app(e.define,c.commit(p("define","symbol",n)),a.commit(p("define","form",n)),t.pure(n.meta)))}function v(n){return h("set").seq2R(t.app(e.set,c.commit(p("set","symbol",n)),a.commit(p("set","form",n)),t.pure(n.meta)))}function g(n){return h("cond").seq2R(t.app(e.cond,m.commit(p("cond","predicate/result pairs",n)),a.commit(p("cond","else form",n)),t.pure(n.meta)))}function y(t,n,r,i,s,o){var u=s.pop();return e.lambda(r,s,u,o)}function b(e){var n={},r;for(r=0;r<e.length;r++){if(e[r]in n)return t.error({message:"repeated symbol in parameter list",rule:"lambda",symbols:e});n[e[r]]=1}return t.pure(e)}function E(e){return t.app(y,h("lambda"),r("open-square").commit(p("lambda","parameter list",e)),w.many0().bind(b),r("close-square").commit(p("lambda","']' to close parameter list",e)),a.many1().commit(p("lambda","body forms",e)),t.pure(e.meta))}var i=r("integer").plus(r("float")).fmap(function(t){return e.number(parseFloat(t.value),t.meta)}),o=r("string").fmap(s),u=r("symbol").fmap(function(t){return e.symbol(t.value,t.meta)}),a=t.error("javascript hack to allow mutual recursion -- still need to set function"),f=r("open-square").bind(function(n){return a.many0().fmap(function(t){return e.list(t,n.meta)}).seq2L(t.item.bind(function(e){return e.value==="]"?t.pure(null):t.error({message:"unable to match list",open:n,"expected close":e})})).commit({message:"unable to match list",open:n})}),l=r("open-paren").bind(function(n){return t.app(e.application,a,a.many0(),t.pure(n.meta)).seq2L(t.item.bind(function(e){return e.value===")"?t.pure(null):t.error({message:"unable to match application",open:n,"expected close":e})})).commit({message:"unable to match application",open:n})}),c=u.fmap(function(e){return e.value}),m=r("open-square").seq2R(r("open-square").seq2R(t.all([a,a])).seq2L(r("close-square")).many0()).seq2L(r("close-square")),w=c.plus(t.item.bind(function(e){return e.tokentype==="close-square"?t.zero:t.error({message:"non-symbol in parameter list",rule:"lambda",token:e})})),S=r("open-curly").bind(function(e){return t.any([d(e),v(e),g(e),E(e)]).commit({message:"unable to match special form",open:e}).seq2L(t.item.bind(function(n){return n.value==="}"?t.pure(null):t.error({message:"unable to match special form",open:e,"expected close":n})}))});a.parse=t.any([S,l,f,u,i,o]).parse;var x={"}":1,"]":1,")":1},T=t.item.bind(function(e){return e.value in x?t.error({message:"unmatched close brace",token:e}):t.zero}).not0().seq2R(a).many0().seq2L(t.get.bind(function(e){return t.item.not0().commit({message:"unable to parse entire token stream","remaining tokens":e})}));return{number:i,symbol:u,string:o,application:l,list:f,special:S,form:a,parse:T}}),define("app/data",[],function(){function e(e,t,n,r,i){this.type=e,this.expected=t,this.actual=n,this.fname=r,this.message=i}function t(t,n,r,i){if(t!==n)throw new e("TypeError",t,n,r,i)}function n(t,n,r,i){if(t!==n)throw new e("NumArgsError",t,n,r,i)}function r(e){this.value=e,this.type="number"}function i(e){this.value=e,this.type="char"}function s(e){this.value=e,this.type="list"}function o(e,t,n){this.argTypes=e,this.name=t,this.value=n,this.type="function"}function u(){this.type="null"}function a(e){this.value=e,this.type="boolean"}function f(e){var t=[],n;for(n=0;n<e.length;n++)t.push(new i(e[n]));return new s(t)}return e.prototype.toString=function(){return this.type+" in "+this.fname+": "+this.message+", expected "+this.expected+" but got "+this.actual},o.prototype.fapply=function(e){n(this.argTypes.length,e.length,this.name);for(var r=0;r<this.argTypes.length;r++)this.argTypes[r]!==null&&t(this.argTypes[r],e[r].type,this.name,"argument "+(r+1));return this.value(e)},{Number:function(e){return new r(e)},Char:function(e){return new i(e)},Boolean:function(e){return new a(e)},Function:function(e,t,n){return new o(e,t,n)},List:function(e){return new s(e)},Null:function(){return new u},makeCharList:f,FunctionError:function(t,n,r,i,s){return new e(t,n,r,i,s)}}}),define("app/functions",["app/data"],function(e){var t=e.Function([null,"list"],"cons",function(t){var n=t[0],r=t[1],i,s;i=[n];for(s=0;s<r.value.length;s++)i.push(r.value[s]);return new e.List(i)}),n=e.Function(["list"],"car",function(t){var n=t[0];if(n.value.length===0)throw e.FunctionError("ValueError","non-empty list","empty list","car","1st arg");return n.value[0]}),r=e.Function(["list"],"cdr",function(t){var n=t[0];if(n.value.length===0)throw e.FunctionError("ValueError","non-empty list","empty list","cdr","1st arg");return e.List(n.value.slice(1))}),i=e.Function(["list"],"null?",function(t){var n=t[0];return e.Boolean(n.value.length===0)}),s={number:1,"char":1,"boolean":1},o=e.Function([null,null],"eq?",function(t){var n=t[0],r=t[1],i=n.type,o=r.type;if(i!==o)throw e.FunctionError("TypeError",i,o,"eq?","arguments must have identical types");if(i in s)return e.Boolean(t[0].value===t[1].value);throw e.FunctionError("TypeError","number/char/boolean",i,"eq?","can't compare type")}),u=e.Function(["number","number"],"+",function(t){return e.Number(t[0].value+t[1].value)}),a=e.Function(["number"],"neg",function(t){return e.Number(-t[0].value)}),f=e.Function(["number","number"],"number-<",function(t){return e.Boolean(t[0].value<t[1].value)}),l=e.Function([null],"type",function(t){return e.makeCharList(t[0].type)});return{cons:t,car:n,cdr:r,"null?":i,"+":u,neg:a,"number-<":f,"eq?":o,type:l}}),define("app/environment",[],function(){function e(e,t){this._parent=e,this._bindings=t,this._history=[]}return e.prototype.hasOwnBinding=function(e){return this._bindings.hasOwnProperty(e)},e.prototype.hasBinding=function(e){return this.hasOwnBinding(e)?!0:this._parent?this._parent.hasBinding(e):!1},e.prototype.addBinding=function(e,t){if(this.hasOwnBinding(e))throw new Error("environment already has binding for "+e);this._bindings[e]=t},e.prototype.getBinding=function(e){if(this.hasOwnBinding(e))return this._bindings[e];if(this._parent)return this._parent.getBinding(e);throw new Error("could not find value for "+e)},e.prototype.setBinding=function(e,t){if(this.hasOwnBinding(e))this._bindings[e]=t;else{if(!this._parent)throw new Error("could not find definition for "+e);this._parent.setBinding(e,t)}},e.prototype.logEvaluation=function(e){this._history.push(e),this._parent&&this._parent.logEvaluation(e)},e.prototype.getLog=function(){return this._history},{Environment:function(t,n){return new e(t,n)}}}),define("app/evaluate",["app/data","app/functions","app/environment"],function(e,t,n){function r(e,t,n,r,i){this.type=e,this.expected=t,this.actual=n,this.sfname=r,this.message=i}function i(e,t,n,i){if(e!==t)throw new r("TypeError",e,t,n,i)}function s(e,t,n,i){if(e!==t)throw new r("NumArgsError",e,t,n,i)}function o(t,n){if(n.hasOwnBinding(t.symbol))throw new r("ValueError","unbound symbol","bound symbol "+t.symbol,"define","cannot redefine symbol");var i=m(t.value,n);return n.addBinding(t.symbol,i),e.Null()}function u(t,n){if(!n.hasBinding(t.symbol))throw new r("ValueError","bound symbol","unbound symbol "+t.symbol,"set","cannot set undefined symbol");var i=m(t.value,n);return n.setBinding(t.symbol,i),e.Null()}function a(e,t){var n=e.branches,r,s;for(s=0;s<n.length;s++){r=m(n[s][0],t),i("boolean",r.type,"cond","condition of argument "+(s+1));if(r.value)return m(n[s][1],t)}return m(e.elseValue,t)}function f(e,t){var n=[];for(var r=0;r<e;r++)n.push(t);return n}function l(t,r){function u(e){var t=n.Environment(r,{}),u,a;for(u=0;u<i.length;u++)t.addBinding(i[u],e[u]);for(a=0;a<s.length;a++)m(s[a],t);return m(o,t)}var i=t.parameters,s=t.bodies,o=t.returnValue;return e.Function(f(i.length,null),"closure",u)}function c(){var r={},i;r["true"]=e.Boolean(!0),r["false"]=e.Boolean(!1);for(i in t)r[i]=t[i];return n.Environment(null,r)}function h(e,t,n){var r=n.map(function(e){return m(e,t)});return e.fapply(r)}function p(e,t){var n=m(e.operator,t),r=e.arguments,i=n.type;if(i==="function")return h(n,t,r);throw new Error("first element in Application must be function (was "+i+")")}function d(t,n){var r=t.elements.map(function(e){return m(e,n)});return e.List(r)}function v(e,t){if(t.hasBinding(e.value))return t.getBinding(e.value);throw new r("UndefinedVariableError","","","evaluateAtom","symbol "+e.value+" is not defined")}function m(t,n){n.logEvaluation(t);if(!n||!t)throw new Error("cannot evaluate if missing form or environment");var r={application:p,list:d,define:o,set:u,cond:a,lambda:l,"char":function(t,n){return e.Char(t.value)},number:function(t,n){return e.Number(t.value)},symbol:v},i=r[t.asttype];if(i)return i(t,n);throw new Error("unrecognized syntax type: "+t.asttype+" in "+JSON.stringify(t))}return r.prototype.toString=function(){return this.type+" in "+this.sfname+": "+this.message+", expected "+this.expected+" but got "+this.actual},{eval:m,getDefaultEnv:c,define:o,set:u,lambda:l,cond:a}}),define("app/beagle",["app/tokenizer","app/parser","app/evaluate","libs/maybeerror"],function(e,t,n,r){function s(e){return n.eval(e,i)}function o(e){return e.filter(function(e){return e.tokentype!=="comment"&&e.tokentype!=="whitespace"})}function u(n){if(typeof n!="string")throw new Error("input must be of type string");var i,u,a;i=e.tokenize(n);if(i.status!=="success")return r.error({cause:"tokenization",error:i.value});u=t.parse.parse(o(i.value));if(u.status!=="success")return r.error({cause:"ast parsing",error:u.value});try{a=u.value.result.map(s)}catch(f){return r.error({cause:"evaluation",error:f})}return r.pure({tokens:i.value,asts:u.value.result,results:a})}var i=n.getDefaultEnv();return{exec:u,environment:i}}),define("repl/formatter",[],function(){function e(e){return e.type!=="list"?!1:e.value.every(function(e){return e.type==="char"})}function t(n){return e(n)?'"'+n.value.map(function(e){return e.value}).join("")+'"':n.type==="function"?"function":n.type==="null"?"null":n.type==="list"?"["+n.value.map(t).join(", ")+"]":n.type==="char"?"'"+n.value+"'":n.type==="boolean"?n.value:n.type==="number"?n.value:(console.log("unrecognized object type in format: "+n.type),n)}return{format:t}}),define("repl/repl",["app/beagle","repl/formatter"],function(e,t){function n(e){var n=$("#env"),r,i;$("#env .envrow").remove();for(r in e._bindings)i=e.getBinding(r),console.log("binding: "+JSON.stringify(i)),n.append('<tr class="envrow"><td>'+r+"</td><td>"+i.type+"</td><td>"+t.format(i)+"</td></tr>")}function r(e){return t.format(e)}function i(e,t){var n=$("#history");n.append("<li><pre>> "+e+"</pre></li>");for(var i=0;i<t.asts.length;i++)n.append("<li>"+r(t.results[i])+"</li>")}function s(){$("#expr").val("")}function o(){var e=$("#history");e.scrollTop(e.prop("scrollHeight"))}function u(t,r){i(t,r),s(),n(e.environment),o()}function a(e,t){var n=$("#history"),r=JSON.stringify(t);n.append("<li><pre>> "+e+"</pre></li>"),n.append("<li>ERROR: "+r+"</li>")}function f(e,t){a(e,t),o()}function l(){$(document).ready(function(){$("#expr").bind("keydown",function(t){var n=t.keyCode?t.keyCode:t.which;if(n==13){var r=$("#expr").val(),i=e.exec(r,e.environment);return i.status==="success"?u(r,i.value):f(r,i.value),!1}return!0}),n(e.environment)})}return{setUp:l}}),require(["repl/repl"],function(e){e.setUp()}),define("main",function(){});